<link rel="stylesheet" href="/css/idea-form.css">

<div class="home-wrapper">
  {{> sidebar}}
  {{> messages}}
  
  <!-- Main Content -->
  <div class="home-main">
    <!-- Header -->
    <div class="home-header">
      <div class="header-left">
        <a href="{{#if isOwner}}/ideas{{else}}/explore{{/if}}" class="back-link">
          <i class="fas fa-arrow-left"></i>
        </a>
        <h1 class="page-title">{{idea.title}}</h1>
      </div>
      {{#if isOwner}}
      <div class="header-right">
        <a href="/ideas/{{idea.id}}/edit" class="edit-idea-btn">
          <i class="fas fa-pencil-alt"></i>
          <span>Edit</span>
        </a>
        <button class="delete-idea-btn" data-id="{{idea.id}}">
          <i class="fas fa-trash"></i>
          <span>Delete</span>
        </button>
      </div>
      {{/if}}
    </div>
    
    {{#unless isOwner}}
    <!-- Author Info Section for non-owner views -->
    <div class="author-info-section">
      <a href="/author/{{idea.User.id}}" class="author-info-card author-info-link">
        <img src="{{defaultAvatar idea.User.avatar}}" alt="{{idea.User.name}}" class="author-info-avatar">
        <div class="author-info-details">
          <span class="author-info-label">Created by</span>
          <span class="author-info-name">{{idea.User.name}}</span>
        </div>
      </a>
    </div>
    {{/unless}}

    <!-- Structured Idea Content -->
    <div class="idea-detail-content">
      <div class="idea-detail-structured">
        
        <!-- Idea Details Section -->
        <div class="section-group">
          <h3 class="section-title">IDEA DETAILS</h3>
          
          <!-- Title Field -->
          <div class="form-field">
            <label class="field-label">Title</label>
            <div class="field-display title-display">{{idea.title}}</div>
          </div>
          
          <!-- Content Field -->
          <div class="form-field">
            <label class="field-label">Content</label>
            <div class="field-display content-display">{{#if idea.content}}{{idea.content}}{{else}}<span class="content-empty">No content provided.</span>{{/if}}</div>
          </div>
          
          <!-- Tags and Visibility Row -->
          <div class="metadata-row">
            <div class="metadata-field">
              <label class="field-label">Tags</label>
              {{#if idea.tags.length}}
                <div class="field-display metadata-display tag-container">
                  {{#each idea.tags}}
                    <span class="tag-badge {{getTagColor @index}}" title="{{name}}">{{name}}</span>
                  {{/each}}
                </div>
              {{else}}
                <div class="field-display metadata-display tags-placeholder">
                  <i class="fas fa-tag"></i>
                  <span class="placeholder-text">No tags yet</span>
                </div>
              {{/if}}
            </div>
            <div class="metadata-field">
              <label class="field-label">Visibility</label>
              <div class="field-display metadata-display">
                {{#if idea.isPublic}}
                <i class="fas fa-globe"></i>
                <span>Public</span>
                {{#if idea.shareLink}}
                <button class="share-btn" data-link="{{idea.shareLink}}" title="Copy share link">
                  <i class="fas fa-share"></i>
                </button>
                {{/if}}
                {{else}}
                <i class="fas fa-lock"></i>
                <span>Private</span>
                {{/if}}
              </div>
            </div>
          </div>
          
          <!-- Dates Row -->
          <div class="metadata-row dates-row">
            <div class="metadata-field">
              <label class="field-label">Created Date</label>
              <div class="field-display metadata-display">
                <i class="fas fa-calendar-alt"></i>
                <span>{{formatDate idea.createdAt}}</span>
              </div>
            </div>
            {{#if idea.updatedAt}}
            <div class="metadata-field">
              <label class="field-label">Last Updated</label>
              <div class="field-display metadata-display">
                <i class="fas fa-edit"></i>
                <span>{{formatDate idea.updatedAt}}</span>
              </div>
            </div>
            {{else}}
            <div class="metadata-field">
              <!-- Empty space for visual balance -->
            </div>
            {{/if}}
          </div>
        </div>
        
      </div>
    </div>
  </div>
</div>


<style>
.back-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--neutral-600);
  text-decoration: none;
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
  transition: color 0.2s ease;
}

.back-link:hover {
  color: var(--blue-500);
}

/* Author info section */
.author-info-section {
  max-width: 800px;
  margin: 0 auto var(--spacing-lg) auto;
}

.author-info-card {
  background: var(--bg-primary);
  border: 1px solid var(--neutral-200);
  border-radius: 12px;
  padding: 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  text-decoration: none;
  color: inherit;
  transition: all 0.2s ease;
}

.author-info-link:hover {
  background: var(--blue-50);
  border-color: var(--blue-200);
  text-decoration: none;
  color: inherit;
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
}

.author-info-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
  border: 1px solid var(--neutral-200);
}

.author-info-details {
  display: flex;
  flex-direction: column;
  gap: 0.125rem;
}

.author-info-label {
  font-size: 11px;
  color: var(--neutral-500);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.author-info-name {
  font-size: 14px;
  color: var(--neutral-800);
  font-weight: 600;
}

.dark-mode .author-info-card {
  background: #262626;
  border-color: #404040;
}

.dark-mode .author-info-link:hover {
  background: rgba(59, 130, 246, 0.1);
  border-color: rgba(59, 130, 246, 0.3);
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.25);
}

.dark-mode .author-info-avatar {
  border-color: #404040;
}

.dark-mode .author-info-label {
  color: #737373;
}

.dark-mode .author-info-name {
  color: #e5e5e5;
}

.idea-detail-content {
  max-width: 800px;
  margin: 0 auto;
  padding: var(--spacing-lg) 0;
}

.idea-detail-structured {
  background: var(--bg-primary);
  border-radius: 16px;
  padding: 2.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border: 1px solid var(--neutral-200);
  min-height: 600px;
}

/* Reuse modal styles for structured layout */
.section-group {
  margin-bottom: var(--spacing-xl);
}

.section-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--neutral-500);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 0 0 var(--spacing-lg) 0;
}

.form-field {
  margin-bottom: 2rem;
}

.field-label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: var(--neutral-700);
  margin-bottom: var(--spacing-sm);
}

.field-display {
  background: var(--bg-secondary);
  border: 1px solid var(--neutral-200);
  border-radius: var(--radius-md);
  padding: var(--spacing-md);
  font-size: 14px;
  color: var(--neutral-800);
  line-height: 1.5;
}

.title-display {
  font-size: 18px;
  font-weight: 600;
  color: var(--neutral-900);
}

.content-display {
  min-height: 180px;
  white-space: pre-wrap;
  word-wrap: break-word;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.6;
  font-size: 15px;
  padding: 1rem 1rem 1rem 1rem !important;
  display: block;
  vertical-align: top;
}

.content-empty {
  color: var(--neutral-400);
  font-style: italic;
}

/* Metadata Row */
.metadata-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.dates-row {
  margin-top: 1rem;
  margin-bottom: 0;
}

/* Tags placeholder styling */
.tags-placeholder .placeholder-text {
  color: var(--neutral-400);
  font-style: italic;
}

.metadata-field {
  /* Individual metadata field styling */
}

.metadata-display {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  background: var(--bg-secondary);
  border: 1px solid var(--neutral-200);
  border-radius: var(--radius-md);
  padding: var(--spacing-md);
  font-size: 14px;
  color: var(--neutral-700);
}

.metadata-display i {
  color: var(--neutral-500);
  font-size: 12px;
}

/* Share button in metadata */
.metadata-display .share-btn {
  background: none;
  border: none;
  color: var(--blue-500);
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 4px;
  transition: background-color 0.2s ease;
  margin-left: auto;
  font-size: 12px;
}

.metadata-display .share-btn:hover {
  background: var(--blue-100);
}

/* Header buttons */
.edit-idea-btn, .delete-idea-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border: 1px solid var(--neutral-300);
  background: var(--bg-primary);
  color: var(--neutral-600);
  border-radius: 6px;
  text-decoration: none;
  font-size: 0.9rem;
  transition: all 0.2s ease;
  cursor: pointer;
}

.edit-idea-btn:hover {
  background: var(--blue-50);
  color: var(--blue-600);
  border-color: var(--blue-300);
}

.delete-idea-btn:hover {
  background: var(--red-50);
  color: var(--red-600);
  border-color: var(--red-300);
}

/* Dark mode styles */
.dark-mode .idea-detail-structured {
  background: #262626;
  border-color: #404040;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.dark-mode .section-title {
  color: #737373;
}

.dark-mode .field-label {
  color: #a3a3a3;
}

.dark-mode .field-display {
  background: #171717;
  border-color: #404040;
  color: #e5e5e5;
}

.dark-mode .title-display {
  color: #f5f5f5;
}

.dark-mode .content-display {
  background: #171717;
  border-color: #404040;
  color: #d4d4d4;
}

.dark-mode .metadata-display {
  background: #171717;
  border-color: #404040;
  color: #d4d4d4;
}

.dark-mode .metadata-display i {
  color: #737373;
}

.dark-mode .content-empty {
  color: #737373;
}

.dark-mode .tags-placeholder .placeholder-text {
  color: #737373;
}

/* Enhanced tag display for idea-detail page */
.metadata-display.tag-container {
  flex-wrap: wrap;
  align-items: flex-start;
  min-height: 2.5rem;
  max-height: none; /* Remove height restriction */
  gap: 0.5rem;
}

.metadata-display .tag-badge {
  max-width: 200px; /* Prevent extremely long tags */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  cursor: help; /* Indicate there might be more text */
}

.metadata-display .tag-badge:hover {
  transform: none; /* Remove hover animation to avoid layout issues */
  position: relative;
}

/* Tooltip for long tags */
.metadata-display .tag-badge[title]:hover::after {
  content: attr(title);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 12px;
  white-space: nowrap;
  z-index: 1000;
  margin-bottom: 4px;
}

.dark-mode .metadata-display .tag-badge[title]:hover::after {
  background: rgba(255, 255, 255, 0.9);
  color: #333;
}

/* Responsive design */
@media (max-width: 768px) {
  .metadata-row {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .header-right {
    display: flex;
    gap: 0.5rem;
  }
  
  .idea-detail-structured {
    padding: var(--spacing-lg);
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Delete button functionality
  const deleteBtn = document.querySelector('.delete-idea-btn');
  if (deleteBtn) {
    deleteBtn.addEventListener('click', function() {
      const ideaId = this.getAttribute('data-id');
      const ideaTitle = document.querySelector('.page-title').textContent;
      
      const confirmed = confirm(`Are you sure you want to delete "${ideaTitle}"?\n\nThis action cannot be undone.`);
      
      if (confirmed) {
        this.disabled = true;
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
        
        fetch(`/ideas/${ideaId}`, {
          method: 'DELETE',
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Idea deleted successfully!');
            window.location.href = '/ideas';
          } else {
            throw new Error(data.message || 'Failed to delete idea');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert(`Failed to delete idea: ${error.message}`);
          this.disabled = false;
          this.innerHTML = '<i class="fas fa-trash"></i> Delete';
        });
      }
    });
  }
  
  // Share button functionality
  const shareBtn = document.querySelector('.share-btn');
  if (shareBtn) {
    shareBtn.addEventListener('click', function() {
      const shareLink = this.getAttribute('data-link');
      const fullUrl = `${window.location.origin}/explore?share=${shareLink}`;
      
      navigator.clipboard.writeText(fullUrl).then(() => {
        alert('Share link copied to clipboard!');
      }).catch(() => {
        prompt('Copy this link:', fullUrl);
      });
    });
  }
});
</script>